{% extends 'base.html' %}
{% block content %}

<style>
    .lesson-badge {
        font-size: 12px;
    }
</style>

<h2>{{ course.title }}</h2>
<p>{{ course.description }}</p>

<!-- =========================
     COURSE COMPLETION
========================= -->
{% if course_completed %}
<div class="alert alert-success d-flex justify-content-between align-items-center">
    <span>ðŸŽ“ You have successfully completed this course!</span>
    <a href="{% url 'download_certificate' course.id %}"
       class="btn btn-sm btn-outline-success">
        ðŸ“„ Download Certificate
    </a>
</div>
{% endif %}

<!-- =========================
     ADMIN ACTIONS (COURSE)
     (ONLY VALID ACTIONS)
========================= -->
{% if user.role == 'ADMIN' %}
<div class="mb-3">
    <a href="{% url 'add_lesson' course.id %}" class="btn btn-success">
        âž• Add Lesson
    </a>
</div>
{% endif %}

<!-- =========================
     ENROLLMENT STATUS (STUDENT)
========================= -->
{% if user.role != 'ADMIN' %}
    {% if not enrolled %}
        <a href="{% url 'enroll_course' course.id %}"
           class="btn btn-primary mb-3">
            ðŸ“˜ Enroll in Course
        </a>
    {% else %}
        <div class="alert alert-success mb-3">
            âœ… You are enrolled in this course
        </div>
    {% endif %}
{% endif %}

<hr>

<h4>Lessons</h4>

<ul class="list-group">

{% if enrolled or user.role == 'ADMIN' %}
    {% for lesson in lessons %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>
            <strong>{{ lesson.order }}.</strong>
            {{ lesson.title }}

            {% if not lesson.is_active %}
            <span class="badge bg-secondary lesson-badge">
                Inactive
            </span>
            {% endif %}
        </span>

        {% if user.role != 'ADMIN' %}
        <a href="{% url 'lesson_detail' lesson.id %}"
           class="btn btn-sm btn-outline-primary">
            Open
        </a>
        {% endif %}
    </li>
    {% empty %}
    <li class="list-group-item">
        No lessons added yet.
    </li>
    {% endfor %}
{% else %}
    <li class="list-group-item text-muted">
        ðŸ”’ Enroll in this course to access lessons.
    </li>
{% endif %}

</ul>

<a href="{% url 'courses' %}" class="btn btn-secondary mt-3">
    â¬… Back to Courses
</a>

{% endblock %}
